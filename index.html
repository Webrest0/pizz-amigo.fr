<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PIZZ’AMIGO — Montmerle-sur-Saône</title>
<style>
  :root{
    --bg:#0b0f14;--panel:#101722;--line:#283149;--muted:#b8c2d6;
    --green:#1fcf7c;--red:#e55252;--accent:#ffb54c;
  }
  *{box-sizing:border-box} html,body{margin:0;background:var(--bg);color:#fff;font-family:system-ui,Segoe UI,Roboto,Arial}
  .wrap{max-width:980px;margin:18px auto;padding:0 14px}
  .brand{display:flex;align-items:center;gap:10px;margin:6px 0 12px}
  .brand .dot{width:10px;height:10px;border-radius:50%;background:#37d36a;box-shadow:0 0 8px #37d36a}
  .brand .name{font-weight:800;letter-spacing:.5px}
  .hero{border-radius:18px;overflow:hidden;position:relative;border:1px solid rgba(255,255,255,.08)}
  .hero img{display:block;width:100%;height:260px;object-fit:cover;filter:contrast(1.05) saturate(1.05)}
  .hero .scrim{position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,0) 35%,rgba(0,0,0,.75))}
  .hero .txt{position:absolute;left:16px;right:16px;bottom:14px}
  h1{margin:0 0 6px 0;font-size:28px}
  .badge{display:inline-flex;gap:8px;align-items:center;border:1px solid rgba(255,255,255,.26);
    padding:6px 10px;border-radius:999px;background:rgba(0,0,0,.28);backdrop-filter:blur(4px);width:max-content;margin:10px}
  .badge .b-dot{width:8px;height:8px;border-radius:50%;background:#36d36a}
  .note{background:rgba(229,82,82,.18);border:1px solid rgba(229,82,82,.5);color:#ffd3d3;padding:12px 14px;border-radius:14px;margin:14px 0}
  h2{margin:18px 0 8px;font-size:28px}
  p{color:var(--muted);margin:8px 0 16px}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:14px;margin:12px 0}
  .row{display:flex;justify-content:space-between;align-items:center;gap:12px}
  .price{color:var(--green);font-weight:800;white-space:nowrap;min-width:70px;text-align:right}
  .btn{border:1px solid rgba(255,255,255,.25);background:transparent;color:#fff;border-radius:999px;padding:8px 12px;cursor:pointer}
  .btn.primary{background:var(--green);color:#001b10;border-color:transparent}
  .btn.red{border-color:#ff8b8b;color:#ffb4b4}
  .item-name{font-size:20px;font-weight:800}
  .item-desc{color:var(--muted)}
  /* barre panier */
  #cart-bar{position:sticky;bottom:0;left:0;right:0;background:rgba(0,0,0,.55);backdrop-filter:blur(6px);padding:12px;display:flex;gap:12px;justify-content:center;z-index:50}
  #cart-bar.hidden{display:none}
  /* modal checkout */
  dialog{border:1px solid var(--line);background:var(--panel);color:#fff;border-radius:18px;max-width:760px;width:calc(100% - 24px)}
  dialog::backdrop{background:rgba(0,0,0,.6)} .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .slots{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
  .pill{border:1px solid var(--line);border-radius:12px;padding:10px;text-align:center;cursor:pointer}
  .pill.active{outline:2px solid var(--accent);background:rgba(255,181,76,.08)}
  input,textarea{width:100%;border:1px solid var(--line);background:#0e1420;color:#fff;border-radius:10px;padding:10px}
  label{color:#cfd6e7;font-size:.95rem}
  .infos{background:linear-gradient(135deg, rgba(32,148,93,.12), rgba(229,82,82,.10));border:1px solid var(--line);border-radius:18px;padding:14px}
  .infos a{color:#9ec7ff} footer{opacity:.75;margin:22px 0 10px;font-size:.95rem}
  /* panneau erreur */
  #err{position:fixed;right:8px;bottom:8px;max-width:92vw;background:#2a1b1b;border:1px solid #5d2f2f;border-radius:10px;padding:10px 12px;display:none;z-index:999}
  #err pre{white-space:pre-wrap;margin:6px 0 0 0;color:#ffd1d1}
</style>
</head>
<body>
<div class="wrap">
  <div class="brand"><span class="dot"></span><div class="name">PIZZ’AMIGO</div></div>
  <div class="badge"><span class="b-dot"></span><b>Ouverture week-end</b></div>

  <!-- HERO grand & arrondi -->
  <section class="hero">
    <img src="./images/oven.jpg" alt="Four à pizza traditionnel" />
    <div class="scrim"></div>
    <div class="txt"><h1>PIZZ’AMIGO — Montmerle-sur-Saône</h1><div style="color:#e8eefc">Le goût authentique de l’Italie près de chez vous.</div></div>
  </section>

  <div class="note"><b>Fermé pour le moment</b> — retrouvez-nous ce week-end !</div>

  <h2>Notre carte</h2>
  <p>Boissons : réglez en ligne, <b>saveur choisie sur place</b>. Supplément (viande / poisson / œuf / fromage) : <b>+1 €</b> par ajout.</p>

  <section id="menu" class="menu"></section>

  <!-- Barre panier -->
  <div id="cart-bar" class="hidden">
    <span>Panier • <b><span id="cart-total">0,00</span> €</b></span>
    <button class="btn" id="btn-view">Voir panier</button>
    <button class="btn primary" id="btn-checkout">Passer commande</button>
  </div>

  <!-- Modal checkout -->
  <dialog id="checkout">
    <form method="dialog" style="padding:16px">
      <h2 style="margin:4px 0 10px">Finaliser la commande</h2>
      <div id="ck-items" class="card" style="min-height:40px"></div>
      <div class="grid2" style="margin-top:8px">
        <label>Nom*<br><input id="ck-name" placeholder="Votre nom"></label>
        <label>Téléphone*<br><input id="ck-phone" placeholder="06…"></label>
        <label>Heure de retrait*<br><input id="ck-slot" value="19:00"></label>
        <label>Commentaire (optionnel)<br><textarea id="ck-note" placeholder="Sans olives, etc."></textarea></label>
      </div>
      <div class="slots" style="margin:12px 0">
        <div class="pill">18:00</div><div class="pill">18:30</div><div class="pill">19:00</div><div class="pill">19:30</div>
        <div class="pill">20:00</div><div class="pill">20:30</div>
      </div>
      <div style="display:flex;gap:10px;justify-content:flex-end">
        <button class="btn" id="btn-close">Fermer</button>
        <button class="btn primary" id="btn-send">Envoyer la commande</button>
      </div>
    </form>
  </dialog>

  <!-- Infos pratiques -->
  <section class="infos" style="margin-top:18px">
    <h3>Infos pratiques</h3>
    <ul>
      <li><b>Vendredi soir</b> — Saint-Georges-de-Reneins (Parking Caisse d’épargne) • 18:00–21:00</li>
      <li><b>Samedi soir</b> — Amareins (carrefour des feux) • 18:00–21:00</li>
      <li><b>Dimanche soir</b> — Amareins (carrefour des feux) • 18:00–21:00</li>
    </ul>
    <p><b>Téléphone :</b> <a href="tel:+33680480456">06 80 48 04 56</a></p>
  </section>

  <footer>© PIZZ’AMIGO — Montmerle-sur-Saône</footer>
  <div id="err"><b>Erreur JavaScript</b><pre id="err-msg"></pre></div>
</div>

<script>
/* ==== Anti page blanche ==== */
function showErr(msg){const b=document.getElementById('err');b.style.display='block';document.getElementById('err-msg').textContent=msg;}
addEventListener('error',e=>showErr(e.message+'\\n'+(e.error&&e.error.stack||'')));
addEventListener('unhandledrejection',e=>showErr('Promise rejetée: '+(e.reason&&e.reason.message||e.reason)));

/* ==== CONFIG (MODIFIE ICI si besoin) ==== */
const API_URL = "https://script.google.com/macros/s/AKfycbyePXcqPFPs0uhNOcVM5J5Nq3LCgsrB9UKVOmit1HVoTBzCdZRDCxEntrydbXSyQMXu/exec"; // <— MODIFIE ICI
const SUPPL_PRICE = 1.00;
const SUPPL_CHOICES = ["viande","poisson","œuf","fromage"];

/* ==== Carte (extrait) ==== */
const MENU=[
  {n:"Margharita",p:7.50,d:"tomate, emmental"},
  {n:"Chasseur",p:8.50,d:"tomate, emmental, champignons"},
  {n:"Sicilienne",p:8.50,d:"tomate, emmental, anchois"},
  {n:"Napolitaine",p:9.00,d:"tomate, emmental, jambon"},
  {n:"Norvégienne",p:12.50,d:"emmental, saumon fumé, mozzarella, crème"},
  {n:"Burger",p:12.00,d:"tomate, emmental, viande hachée, oignons, cheddar, sauce burger"},
  {n:"Canette 33cl (choisie sur place)",p:1.50,d:"boisson — saveur choisie sur place",drink:true},
  {n:"Bouteille 50cl (choisie sur place)",p:3.00,d:"boisson — saveur choisie sur place",drink:true},
];

const cart={items:[],get total(){return this.items.reduce((s,i)=>s+(i.price+(i.suppl?.price||0))*i.qty,0)},add(p,withSuppl=false,typ=null){
  const key=p.n+'|'+(withSuppl?typ:'');const it=this.items.find(i=>i._k===key);
  if(it) it.qty++; else this.items.push({_k:key,name:p.n,qty:1,price:p.p,suppl:withSuppl?{type:typ,price:SUPPL_PRICE}:null});
  renderCartBar();
},remove(i){this.items.splice(i,1);renderCartBar();},clear(){this.items.length=0;renderCartBar();}};

const euro=v=>v.toFixed(2).replace('.',','); const $=s=>document.querySelector(s);

function renderMenu(){
  const root=$("#menu"); root.innerHTML='';
  MENU.forEach(p=>{
    const el=document.createElement('div'); el.className='card';
    el.innerHTML=`<div class="row"><div><div class="item-name">${p.n}</div><div class="item-desc">${p.d||''}</div></div>
      <div class="row" style="gap:10px"><div class="price">${euro(p.p)} €</div><button class="btn add">Ajouter</button></div></div>`;
    el.querySelector('.add').onclick=()=>{
      if(p.drink){ cart.add(p,false,null); return; }
      if(!confirm("Supplément +1 € ?\nOK = Oui · Annuler = Non")){ cart.add(p,false,null); return; }
      const t=prompt("Choisis le type de supplément : viande / poisson / œuf / fromage","viande")||"viande";
      const choice=t.toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu,''); 
      const valid=SUPPL_CHOICES.find(c=>c===choice)||"viande";
      cart.add(p,true,valid);
    };
    root.appendChild(el);
  });
}

function renderCartBar(){ const bar=$("#cart-bar"); $("#cart-total").textContent=euro(cart.total); bar.classList.toggle('hidden',cart.items.length===0); }

function openModal(){
  const m=$("#checkout"), list=$("#ck-items"); list.innerHTML='';
  cart.items.forEach((it,idx)=>{
    const sup=it.suppl?` (+${euro(it.suppl.price)} € • ${it.suppl.type})`:'';
    const line=document.createElement('div'); line.className='row'; line.style.cssText='margin:10px 0;border-bottom:1px solid rgba(255,255,255,.08)';
    line.innerHTML=`<div><b>${it.name}</b>${sup}</div>
      <div class="row" style="gap:6px">
        <button class="btn" aria-label="moins">−</button><div style="min-width:24px;text-align:center">${it.qty}</div>
        <button class="btn" aria-label="plus">+</button><button class="btn red" aria-label="sup">🗑️</button>
        <div class="price">${euro((it.price+(it.suppl?.price||0))*it.qty)} €</div></div>`;
    line.querySelector('[aria-label="moins"]').onclick=()=>{ if(it.qty>1) it.qty--; else cart.remove(idx); openModal(); renderCartBar(); };
    line.querySelector('[aria-label="plus"]').onclick =()=>{ it.qty++; openModal(); renderCartBar(); };
    line.querySelector('[aria-label="sup"]').onclick  =()=>{ cart.remove(idx); openModal(); };
    list.appendChild(line);
  });
  document.querySelectorAll('.pill').forEach(p=>{
    p.onclick=()=>{ document.querySelectorAll('.pill').forEach(x=>x.classList.remove('active')); p.classList.add('active'); $("#ck-slot").value=p.textContent.trim(); };
  });
  m.showModal();
}
function closeModal(){ $("#checkout").close(); }

async function sendOrder(){
  try{
    const name=$("#ck-name").value.trim(), phone=$("#ck-phone").value.trim(), slot=$("#ck-slot").value.trim(), note=$("#ck-note").value.trim();
    if(!name||!phone||!slot||cart.items.length===0){ alert("Merci de compléter nom, téléphone, horaire et panier."); return; }
    const payload={name,phone,slot,note,items:cart.items.map(i=>({name:i.name,qty:i.qty,price:i.price,supplType:i.suppl?.type||null,supplPrice:i.suppl?.price||0})),total:Number(cart.total.toFixed(2)),source:"site"};
    const res=await fetch(API_URL,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(payload)});
    const txt=await res.text(); let data; try{data=JSON.parse(txt);}catch{data={ok:false,raw:txt};}
    if(!res.ok||!data.ok) throw new Error(data.error||('HTTP '+res.status));
    cart.clear(); closeModal(); alert("Commande enregistrée. Merci !");
  }catch(err){ showErr(String(err)); alert("Impossible d'envoyer la commande. Merci de réessayer."); }
}

/* Hooks */
$("#btn-view").onclick=openModal; $("#btn-checkout").onclick=openModal;
$("#btn-close").onclick=e=>{e.preventDefault();closeModal();};
$("#btn-send").onclick =e=>{e.preventDefault();sendOrder();};

renderMenu(); renderCartBar();
</script>
</body>
</html>
