<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PIZZ’AMIGO — Montmerle-sur-Saône</title>
<style>
:root{
  --bg:#0d1117; --panel:#101726; --line:#22304b;
  --txt:#e6ebf5; --muted:#b0bad0; --green:#19c37d; --accent:#ff9f3f;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--txt);font-family:system-ui,Segoe UI,Roboto,Arial}
a{color:#9bbcff}
.topbar{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;background:linear-gradient(180deg,#0f1623,rgba(15,22,35,.85))}
.brand{font-weight:800;letter-spacing:.5px}
.hero{
  min-height:44vh;display:grid;align-items:end;
  background:url('./images/oven.jpg') center/cover no-repeat fixed;
}
.hero .hero-content{padding:28px 16px;background:linear-gradient(180deg,rgba(0,0,0,0) 0%, rgba(0,0,0,.66) 100%)}
.hero h1{margin:0 0 8px 0;font-size:clamp(24px,5.5vw,44px)}
.hero p{margin:0;opacity:.9}
.banner{background:#c43d3d;color:#fff;text-align:center;padding:10px 12px;font-weight:700}
.section{padding:18px 16px}
h2{margin:0 0 10px 0;font-size:clamp(20px,3.5vw,28px)}
.small{opacity:.75}
#menu-list{list-style:none;margin:0;padding:0;border-radius:12px;overflow:hidden}
.menu-item{display:flex;justify-content:space-between;gap:12px;padding:14px 12px;border-bottom:1px solid var(--line);background:var(--panel)}
.menu-item:last-child{border-bottom:0}
.mi-title{font-weight:700}
.mi-desc{color:var(--muted);font-size:.95rem;margin-top:4px}
.mi-price{color:#31cc7c;font-weight:800;margin-right:12px}
.btn{cursor:pointer;border-radius:999px;padding:8px 14px;border:1px solid var(--accent);color:var(--accent);background:transparent}
.btn.primary{background:var(--green);border:0;color:#000}
.btn.dark{background:rgba(255,255,255,.1);border:0}
#cart-bar{position:sticky;bottom:0;left:0;right:0;display:flex;gap:12px;align-items:center;justify-content:center;background:rgba(10,12,16,.9);backdrop-filter:blur(6px);padding:10px;border-top:1px solid var(--line)}
#cart-bar.hidden{display:none}
dialog{border:1px solid var(--line);background:var(--panel);color:var(--txt);border-radius:12px;padding:14px;max-width:520px;width:92%}
.ck h3{margin:0 0 10px 0}
.ck .ck-items{white-space:pre-wrap;margin-bottom:10px}
.form label{display:block;margin:8px 0}
.form input,.form textarea{width:100%;padding:10px;border-radius:10px;border:1px solid var(--line);background:#0c1320;color:#fff}
.card{background:var(--panel);border:1px solid var(--line);border-radius:12px;padding:14px}
footer{padding:40px 16px;color:var(--muted);text-align:center;border-top:1px solid var(--line);margin-top:24px}
</style>
</head>
<body>

<header class="topbar">
  <div class="brand">PIZZ’AMIGO</div>
  <nav class="small"><a href="#carte">Voir la carte</a> · <a href="#commande">Commander</a></nav>
</header>

<section class="hero">
  <div class="hero-content">
    <h1>PIZZ’AMIGO — Montmerle-sur-Saône</h1>
    <p>Le goût authentique de l’Italie près de chez vous.</p>
  </div>
</section>

<div class="banner">Précommande désactivée — rendez-vous ce week-end !</div>

<main class="section">
  <section id="carte">
    <h2>Notre carte</h2>
    <p class="small">Boissons : réglez en ligne, <strong>choix de la saveur sur place</strong>.</p>
    <ul id="menu-list"></ul>
  </section>

  <section class="section">
    <div class="card">
      <h2>Infos pratiques</h2>
      <div class="small">Nous trouver :</div>
      <ul>
        <li><strong>Vendredi soir</strong> — Saint-Georges-de-Reneins (Parking Caisse d’épargne) • 18:00–21:00 — <a href="https://maps.app.goo.gl/" target="_blank" rel="noopener">Itinéraire</a></li>
        <li><strong>Samedi soir</strong> — Amareins (carrefour des feux) • 18:00–21:00 — <a href="https://maps.app.goo.gl/" target="_blank" rel="noopener">Itinéraire</a></li>
        <li><strong>Dimanche soir</strong> — Amareins (carrefour des feux) • 18:00–21:00 — <a href="https://maps.app.goo.gl/" target="_blank" rel="noopener">Itinéraire</a></li>
      </ul>
      <h3 style="margin-top:10px">Contact</h3>
      <p>Téléphone : <a href="tel:+33680480456">06 80 48 04 56</a> • <a href="https://facebook.com" target="_blank" rel="noopener">Facebook</a></p>
    </div>
  </section>
</main>

<!-- Barre panier -->
<div id="cart-bar" class="hidden" aria-live="polite">
  <span>Panier • <span class="cart-total">0,00</span> €</span>
  <button id="btn-view" class="btn dark">Voir panier</button>
  <button id="btn-checkout" class="btn primary">Passer commande</button>
</div>

<!-- Modal commande -->
<dialog id="checkout" aria-labelledby="ck-title">
  <div class="ck">
    <button id="close-modal" class="btn dark" aria-label="Fermer" style="float:right">×</button>
    <h3 id="ck-title">Finaliser la commande</h3>
    <p class="ck-items"></p>
    <div class="form" id="commande">
      <label>Nom*<input id="ck-name" placeholder="Votre nom" autocomplete="name"></label>
      <label>Téléphone*<input id="ck-phone" placeholder="06…" inputmode="tel" autocomplete="tel"></label>
      <label>Heure de retrait*<input id="ck-slot" value="19:00"></label>
      <label>Commentaire (optionnel)<textarea id="ck-note" placeholder="Sans olives, etc."></textarea></label>
    </div>
    <button id="btn-send" class="btn primary" style="width:100%">Envoyer la commande</button>
  </div>
</dialog>

<footer>© PIZZ’AMIGO — Montmerle-sur-Saône</footer>

<script>
/* ===== CONFIG ===== */
const API_URL = "https://script.google.com/macros/s/AKfycbw_cAhR_LZgNRPzyABxZIWgqaYf-mBTPoisV8QgFgYUE-lVgI5pY-9_RFk_Z0w28itu/exec";
const ADMIN_KEY = ""; // si besoin

/* ===== MENU ===== */
const MENU = [
  { name:"Margharita", price:7.50, desc:"tomate, emmental" },
  { name:"Chasseur", price:8.50, desc:"tomate, emmental, champignons" },
  { name:"Sicilienne", price:8.50, desc:"tomate, emmental, anchois" },
  { name:"Napolitaine", price:9.00, desc:"tomate, emmental, jambon" },
  { name:"Capri", price:9.50, desc:"tomate, emmental, jambon, champignons" },
  { name:"Carnivore", price:11.50, desc:"tomate, emmental, viande hachée, merguez, œuf" },
  { name:"Savoyarde", price:11.00, desc:"tomate, emmental, lardons, reblochon, PDT, crème" },
  { name:"Norvégienne", price:11.50, desc:"tomate, emmental, saumon fumé, mozzarella" },
  { name:"Canette 33cl (boisson - choix sur place)", price:1.50, desc:"Saveur choisie sur place" },
  { name:"Bouteille 50cl (boisson - choix sur place)", price:3.00, desc:"Saveur choisie sur place" },
];

const cart = {
  items: [],
  get total(){ return this.items.reduce((s,i)=>s+i.price*i.qty,0); },
  add(name){
    const m = MENU.find(x=>x.name===name);
    if(!m) return;
    const it = this.items.find(i=>i.name===name);
    if(it) it.qty+=1; else this.items.push({name:m.name, qty:1, price:m.price});
    renderCartBar();
  },
  clear(){ this.items.length=0; renderCartBar(); }
};

function money(v){ return v.toFixed(2).replace(".",","); }

function renderMenu(){
  const ul = document.getElementById("menu-list");
  ul.innerHTML = "";
  MENU.forEach(p=>{
    const li = document.createElement("li");
    li.className = "menu-item";
    li.innerHTML = `
      <div class="mi-left">
        <div class="mi-title">${p.name}</div>
        <div class="mi-desc">${p.desc}</div>
      </div>
      <div class="mi-right">
        <div class="mi-price">${money(p.price)} €</div>
        <button class="btn add">Ajouter</button>
      </div>`;
    li.querySelector(".add").addEventListener("click", ()=>cart.add(p.name));
    ul.appendChild(li);
  });
}

function renderCartBar(){
  const bar = document.getElementById("cart-bar");
  bar.querySelector(".cart-total").textContent = money(cart.total);
  bar.classList.toggle("hidden", cart.items.length===0);
}

function openModal(){
  const dlg = document.getElementById("checkout");
  const items = dlg.querySelector(".ck-items");
  items.innerHTML = cart.items.map(i=>`• ${i.name} × ${i.qty} — ${money(i.price)} €`).join("<br>");
  dlg.showModal();
}
function closeModal(){ document.getElementById("checkout").close(); }

/* ID lisible côté client */
function genLocalId(){
  const d=new Date(); const pad=n=>String(n).padStart(2,"0");
  return `PZ-${d.getFullYear()}${pad(d.getMonth()+1)}${pad(d.getDate())}-${pad(d.getHours())}${pad(d.getMinutes())}-${Math.random().toString(36).slice(2,6).toUpperCase()}`;
}

async function sendOrder(){
  if(cart.items.length===0){ alert("Panier vide."); return; }
  const name  = document.getElementById("ck-name").value.trim();
  const phone = document.getElementById("ck-phone").value.trim();
  const slot  = document.getElementById("ck-slot").value.trim();
  const note  = document.getElementById("ck-note").value.trim();
  if(!name||!phone||!slot){ alert("Merci de compléter nom, téléphone et heure."); return; }

  const payload = {
    id: genLocalId(),
    name, phone, slot, note,
    items: cart.items.map(i=>({name:i.name, qty:i.qty, price:i.price})),
    total: Number(cart.total.toFixed(2)),
    source: "site"
  };

  const url = API_URL + (ADMIN_KEY?`?key=${encodeURIComponent(ADMIN_KEY)}`:"");

  try{
    const res = await fetch(url, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify(payload)
    });
    const text = await res.text();
    let data; try{ data = JSON.parse(text); }catch{ data = {ok:false, error:"bad_json", raw:text}; }

    if(!res.ok || !data.ok){
      console.error("API", res.status, data);
      alert("Impossible d'envoyer la commande. Merci de réessayer ou de contacter le food-truck.");
      return;
    }
    cart.clear();
    closeModal();
    alert("Commande enregistrée (simulation). Merci !");
  }catch(e){
    console.error(e);
    alert("Impossible d'envoyer la commande. Merci de réessayer ou de contacter le food-truck.");
  }
}

document.addEventListener("DOMContentLoaded", ()=>{
  renderMenu(); renderCartBar();
  document.getElementById("btn-view").addEventListener("click", openModal);
  document.getElementById("btn-checkout").addEventListener("click", openModal);
  document.getElementById("btn-send").addEventListener("click", sendOrder);
  document.getElementById("close-modal").addEventListener("click", closeModal);
});
</script>
</body>
</html>
