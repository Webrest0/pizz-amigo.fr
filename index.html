<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PIZZ’AMIGO — Montmerle-sur-Saône</title>
<style>
  :root{
    --bg:#0f1418; --panel:#141b22; --muted:#b9c2d6; --line:#263349;
    --green:#1fb96e; --red:#ce2b37; --white:#f2f5f8; --gold:#f7b544;
    --pill:#243043; --btn:#1d2636;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--white);font-family:system-ui,Segoe UI,Roboto,Arial}
  a{color:#9ec5ff;text-decoration:none}
  h1,h2,h3{margin:0 0 12px}
  .wrap{max-width:960px;margin:0 auto;padding:16px}

  /* HERO */
  .hero{
    margin:16px 0 10px;border-radius:20px;overflow:hidden;position:relative;
    background:#000;
  }
  .hero::before{
    content:"";display:block; padding-top:45%; /* ratio maîtrisé */
    background:url("./images/oven.jpg") center/cover no-repeat;
    filter:brightness(.75);
  }
  .hero .over{
    position:absolute;inset:0;display:flex;flex-direction:column;justify-content:flex-end;
    padding:18px;
    background:linear-gradient(180deg,rgba(0,0,0,0) 20%,rgba(0,0,0,.45) 90%);
  }
  .badge{display:inline-flex;gap:8px;align-items:center;padding:6px 12px;border:1px solid #ffffff33;border-radius:999px;background:#00000055;font-weight:600}
  .dot{width:10px;height:10px;border-radius:50%;background:#20d878;box-shadow:0 0 12px #20d878}
  .subtitle{opacity:.9;margin-top:8px}

  .banner{
    margin:12px 0; padding:12px 14px; background:#4b2226;border:1px solid #7e3036;color:#ffd7d7;border-radius:14px;
    display:flex;gap:14px;align-items:center;
  }
  .banner .led{width:10px;height:10px;border-radius:50%;background:#ff6868;box-shadow:0 0 10px #ff6868}

  /* CONTENT */
  .panel{background:var(--panel);border:1px solid var(--line);border-radius:18px;padding:16px}
  .lead{color:var(--muted)}
  .chip{display:inline-block;padding:8px 12px;background:var(--pill);border:1px solid var(--line);border-radius:999px}

  /* MENU */
  .menu{margin-top:10px}
  .item{display:flex;gap:12px;justify-content:space-between;align-items:center;padding:18px 10px;border-bottom:1px solid #1f2a3d}
  .it-left{max-width:68%}
  .title{font-weight:700;font-size:20px}
  .desc{color:#9fb0c8;margin-top:4px}
  .price{color:var(--green);font-weight:800;display:flex;align-items:baseline;gap:4px}
  .price .euro{font-weight:700}
  .btn{cursor:pointer;border-radius:14px;padding:10px 14px;background:transparent;border:1px solid #ffb7a1;color:#ffb7a1}
  .btn.primary{background:var(--green);color:#05130d;border:0}
  .btn.dark{background:var(--btn);border:1px solid #2c3a55}

  /* CART BAR */
  .cartbar{
    position:sticky; bottom:0; left:0; right:0; backdrop-filter:blur(8px);
    background:rgba(12,17,22,.85); border-top:1px solid #1f2a35;
    padding:12px; display:flex; gap:10px; justify-content:center; align-items:center;
  }
  .cartbar span{font-weight:700}
  .cartbar .muted{color:#9fb0c8;font-weight:500}
  .hide{display:none}

  /* DIALOG */
  dialog{border:0;border-radius:18px;background:#0f1418;color:var(--white);max-width:720px;width:96%}
  .dlg-head{padding:16px 18px;border-bottom:1px dashed #33425e;font-size:22px;font-weight:800}
  .dlgb{padding:16px 18px}
  .cart-line{display:flex;justify-content:space-between;gap:8px;align-items:center;padding:10px 0;border-bottom:1px solid #1b273a}
  .qty{display:flex;gap:8px;align-items:center}
  .qty button{width:30px;height:30px;border-radius:8px;border:1px solid #2b3a55;background:#182131;color:#fff}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin:8px 0 2px}
  .pill{padding:10px 0;border-radius:10px;text-align:center;border:1px solid #2b3a55;background:#182131}
  .pill.active{outline:2px solid var(--green)}
  .two{display:flex;gap:12px}
  .two label{flex:1}
  label{display:block;margin:10px 0 6px;color:#cbd6ea;font-weight:600}
  input,textarea{width:100%;background:#111823;border:1px solid #2b3a55;color:#fff;border-radius:10px;padding:10px}
  .dlg-actions{display:flex;gap:10px;justify-content:flex-end;padding:14px 18px;border-top:1px solid #1b273a}

  /* INFOS */
  .infos li{margin:8px 0}
  footer{color:#9fb0c8;padding:24px 0;text-align:center}
</style>
</head>
<body>
  <div class="wrap">
    <!-- HERO -->
    <header class="hero">
      <div class="over">
        <div class="badge"><span class="dot"></span> PIZZ’AMIGO</div>
        <h1 style="margin-top:10px;">PIZZ’AMIGO — Montmerle-sur-Saône</h1>
        <p class="subtitle">Le goût authentique de l’Italie près de chez vous.</p>
      </div>
    </header>

    <!-- Bandeau statut -->
    <div class="banner">
      <span class="led"></span>
      <div><strong>Fermé pour le moment</strong> — retrouvez-nous ce week-end !</div>
    </div>

    <section class="panel">
      <h2>Notre carte</h2>
      <p class="lead">
        Boissons : réglez en ligne, <strong>savour choisie sur place</strong>. <br>
        <span class="chip">Supplément (viande / poisson / œuf / fromage) : +1&nbsp;€ par ajout.</span>
      </p>

      <!-- MENU -->
      <div id="menu" class="menu"></div>
    </section>

    <!-- Infos pratiques -->
    <section class="panel" style="margin-top:14px;">
      <h2>Infos pratiques</h2>
      <div class="infos">
        <p><strong>Nous trouver :</strong></p>
        <ul>
          <li><strong>Vendredi soir</strong> — Saint-Georges-de-Reneins (Parking Caisse d’épargne) • 18:00–21:00 — <a href="https://maps.google.com/?q=Saint-Georges-de-Reneins%20Caisse%20d%27%C3%A9pargne" target="_blank" rel="noopener">Itinéraire</a></li>
          <li><strong>Samedi soir</strong> — Amareins (carrefour des feux) • 18:00–21:00 — <a href="https://maps.google.com/?q=Amareins%20carrefour%20des%20feux" target="_blank" rel="noopener">Itinéraire</a></li>
          <li><strong>Dimanche soir</strong> — Amareins (carrefour des feux) • 18:00–21:00 — <a href="https://maps.google.com/?q=Amareins%20carrefour%20des%20feux" target="_blank" rel="noopener">Itinéraire</a></li>
        </ul>
        <p>Téléphone : <a href="tel:+33680480456">06 80 48 04 56</a> • <a href="https://facebook.com" target="_blank" rel="noopener">Facebook</a></p>
      </div>
    </section>

    <footer>© PIZZ’AMIGO — Montmerle-sur-Saône</footer>
  </div>

  <!-- Cart bar -->
  <div class="cartbar hide" id="cartbar">
    <span>Panier • <span id="cartTotal">0,00</span> €</span>
    <button class="btn dark" id="btnView">Voir panier</button>
    <button class="btn primary" id="btnCheckout">Passer commande</button>
  </div>

  <!-- MODAL PANIER / CHECKOUT -->
  <dialog id="checkout">
    <div class="dlg-head">Finaliser la commande</div>
    <div class="dlgb">
      <div id="cartLines"></div>
      <p style="text-align:right;margin:8px 0 0;"><strong>Total : <span id="dlgTotal">0,00</span> €</strong></p>

      <div class="two">
        <div style="flex:1">
          <label>Nom*</label>
          <input id="name" placeholder="Votre nom">
        </div>
        <div style="flex:1">
          <label>Téléphone*</label>
          <input id="phone" placeholder="06 …">
        </div>
      </div>

      <label>Heure de retrait*</label>
      <input id="slot" placeholder="19:00" value="19:00">
      <div class="grid" id="slots">
        <!-- boutons créneaux -->
      </div>

      <label>Commentaire (optionnel)</label>
      <textarea id="note" placeholder="Sans olives, etc."></textarea>
      <p class="lead">Choisis un créneau, tu pourras ajuster sur place.</p>
    </div>
    <div class="dlg-actions">
      <button class="btn dark" id="btnClose">Fermer</button>
      <button class="btn primary" id="btnSend">Envoyer la commande</button>
    </div>
  </dialog>

<script>
/* ====== CONFIG ====== */
const API_URL = "https://script.google.com/macros/s/AKfycbw6YCxMsuQWvbseL44mpzaTFsaFq2PtzUhyea6M3yEy5dWjUMg7an97Lld9vo4aFIg7/exec"; // EXEC OK

/* ====== CARTE COMPLÈTE (photo four + toutes pizzas) ======
   Format: { name, price, desc, type:'pizza'|'drink' }
*/
const MENU = [
  {name:"Margharita", desc:"tomate, emmental", price:7.50, type:"pizza"},
  {name:"Chasseur", desc:"tomate, emmental, champignons", price:8.50, type:"pizza"},
  {name:"Sicilienne", desc:"tomate, emmental, anchois", price:8.50, type:"pizza"},
  {name:"Napolitaine", desc:"tomate, emmental, jambon", price:9.00, type:"pizza"},
  {name:"Paysanne", desc:"tomate, emmental, jambon, œuf", price:9.50, type:"pizza"},
  {name:"Capri", desc:"tomate, emmental, jambon, champignons", price:9.50, type:"pizza"},
  {name:"Mozzarella", desc:"tomate, emmental, mozzarella", price:9.50, type:"pizza"},
  {name:"Quatre saisons", desc:"tomate, emmental, oignons, champignons, poivrons, mozzarella", price:9.50, type:"pizza"},
  {name:"Venitienne", desc:"tomate, emmental, roquefort, oignons, crème", price:9.50, type:"pizza"},
  {name:"Oslo", desc:"tomate, emmental, thon, champignons, crème", price:10.00, type:"pizza"},
  {name:"Orientale", desc:"tomate, emmental, merguez, poivrons", price:10.00, type:"pizza"},
  {name:"Bolognaise", desc:"tomate, emmental, viande hachée, crème, mozzarella", price:10.00, type:"pizza"},
  {name:"Fermiere", desc:"tomate, emmental, œuf, lardons, champignons", price:10.00, type:"pizza"},
  {name:"Miel", desc:"crème, emmental, chèvre frais, miel", price:10.50, type:"pizza"},
  {name:"Forestiere", desc:"tomate, emmental, poulet, champignons, crème", price:10.50, type:"pizza"},
  {name:"Lyonnaise", desc:"tomate, emmental, saint-marcellin, poulet, crème", price:11.00, type:"pizza"},
  {name:"Quatre fromages", desc:"tomate, emmental, chèvre, roquefort, mozzarella", price:11.00, type:"pizza"},
  {name:"Paradoxe", desc:"tomate, emmental, œuf, jambon, chorizo, mozzarella", price:11.00, type:"pizza"},
  {name:"Boissee", desc:"crème, emmental, pomme de terre, poulet, poivrons, sauce gruyère", price:11.00, type:"pizza"},
  {name:"Savoyarde", desc:"emmental, lardons, reblochon, pomme de terre, crème", price:11.00, type:"pizza"},
  {name:"Carnivore", desc:"tomate, emmental, viande hachée, merguez, œuf, mozzarella", price:11.50, type:"pizza"},
  {name:"Norvegienne", desc:"emmental, saumon fumé, mozzarella, crème", price:11.50, type:"pizza"},
  {name:"Burger", desc:"tomate, emmental, viande hachée, oignons, cheddar, tomate cerise, sauce burger", price:12.00, type:"pizza"},
  {name:"Canette 33cl (choisie sur place)", desc:"boisson — saveur choisie sur place", price:1.50, type:"drink"},
  {name:"Bouteille 50cl (choisie sur place)", desc:"boisson — saveur choisie sur place", price:3.00, type:"drink"},
];

/* ====== PANIER ====== */
const cart = []; // {name, price, qty, suppl}  suppl = nombre de suppléments (1€)
const euro = v => v.toFixed(2).replace(".", ",");
const totalCart = () => cart.reduce((s,i)=> s + (i.price + (i.suppl||0))*i.qty, 0);

/* Render menu */
function renderMenu(){
  const box = document.getElementById("menu");
  box.innerHTML = "";
  for(const p of MENU){
    const li = document.createElement("div");
    li.className="item";
    li.innerHTML = `
      <div class="it-left">
        <div class="title">${p.name}</div>
        <div class="desc">${p.desc}</div>
      </div>
      <div style="display:flex;align-items:center;gap:10px">
        <div class="price"><span>${euro(p.price)}</span><span class="euro">€</span></div>
        <button class="btn" data-name="${p.name}">Ajouter</button>
      </div>`;
    li.querySelector("button").addEventListener("click", () => addToCart(p));
    box.appendChild(li);
  }
}

/* Ajouter avec question supplément (pour les pizzas) */
function addToCart(prod){
  let suppl = 0;
  if(prod.type === "pizza"){
    // mini choix sans annuler
    const wants = confirm(`Supplément +1 € ?\nOK = Oui • Annuler = Non`);
    if(wants) suppl = 1;
  }
  const found = cart.find(i=> i.name===prod.name && (i.suppl||0)===suppl);
  if(found) found.qty += 1;
  else cart.push({name:prod.name, price:prod.price, qty:1, suppl:suppl});
  updateCartBar();
}

/* Cart bar + modal content */
function updateCartBar(){
  const bar = document.getElementById("cartbar");
  const total = totalCart();
  document.getElementById("cartTotal").textContent = euro(total);
  bar.classList.toggle("hide", cart.length===0);
}

function openModal(){
  const dlg = document.getElementById("checkout");
  const lines = document.getElementById("cartLines");
  lines.innerHTML = "";
  cart.forEach((it,idx)=>{
    const row = document.createElement("div");
    row.className="cart-line";
    const supplTxt = it.suppl? ` (+${it.suppl} suppl.)` : "";
    row.innerHTML = `
      <div><strong>${it.name}</strong>${supplTxt}</div>
      <div class="qty">
        <button data-a="-1">−</button>
        <span>${it.qty}</span>
        <button data-a="+1">+</button>
        <button data-a="del" title="Supprimer" style="margin-left:6px">🗑️</button>
        <div class="price" style="margin-left:8px">
          <span>${euro((it.price + (it.suppl||0))*it.qty)}</span><span class="euro">€</span>
        </div>
      </div>`;
    row.querySelectorAll("button").forEach(b=>{
      b.addEventListener("click", ()=>{
        const a = b.getAttribute("data-a");
        if(a==="+1") it.qty++;
        else if(a==="-1") it.qty = Math.max(1, it.qty-1);
        else if(a==="del"){ cart.splice(idx,1); }
        openModal(); // re-render
        updateCartBar();
      });
    });
    lines.appendChild(row);
  });
  document.getElementById("dlgTotal").textContent = euro(totalCart());

  // créneaux
  const grid = document.getElementById("slots");
  grid.innerHTML = "";
  ["18:00","18:30","19:00","19:30","20:00","20:30"].forEach(t=>{
    const d = document.createElement("div"); d.className="pill"; d.textContent=t;
    d.addEventListener("click", ()=>{
      document.querySelectorAll("#slots .pill").forEach(x=>x.classList.remove("active"));
      d.classList.add("active");
      document.getElementById("slot").value = t;
    });
    grid.appendChild(d);
  });

  dlg.showModal();
}
function closeModal(){ document.getElementById("checkout").close(); }

/* Envoi API (format FR) */
async function sendOrder(){
  const name  = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const slot  = document.getElementById("slot").value.trim();
  const note  = document.getElementById("note").value.trim();
  if(!name || !phone || !slot || cart.length===0){
    alert("Merci de compléter nom, téléphone, horaire et panier."); return;
  }
  const payload = {
    nom: name,
    telephone: phone,
    horaire: slot,
    note: note,
    panier: cart.map(i=>({ name:i.name, qty:i.qty, price:i.price, suppl:i.suppl||0 })),
    total: Number(totalCart().toFixed(2)),
    status: "nouvelle",
    source: "site"
  };

  try{
    const res = await fetch(API_URL, {
      method:"POST",
      headers:{ "Content-Type":"text/plain" }, // évite CORS côté Apps Script
      body: JSON.stringify(payload)
    });
    const txt = await res.text();
    let data; try{ data = JSON.parse(txt); }catch{ data={ok:false,error:"bad_json",raw:txt}; }

    if(!res.ok || !data.ok){
      console.error("API", res.status, data);
      alert("Impossible d'envoyer la commande. Merci de réessayer.");
      return;
    }
    // Succès
    cart.length = 0;
    updateCartBar();
    closeModal();
    toast("✅ Commande enregistrée !");
  }catch(err){
    console.error(err);
    alert("Impossible d'envoyer la commande. Merci de réessayer.");
  }
}

/* Mini toast */
function toast(msg){
  const t = document.createElement("div");
  t.textContent = msg;
  Object.assign(t.style,{
    position:"fixed",left:"50%",bottom:"22px",transform:"translateX(-50%)",
    background:"#16212f",border:"1px solid #28405f",padding:"10px 14px",
    borderRadius:"12px",zIndex:9999
  });
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),2200);
}

/* Hooks */
window.addEventListener("DOMContentLoaded", ()=>{
  renderMenu(); updateCartBar();
  document.getElementById("btnView").addEventListener("click", openModal);
  document.getElementById("btnCheckout").addEventListener("click", openModal);
  document.getElementById("btnClose").addEventListener("click", closeModal);
  document.getElementById("btnSend").addEventListener("click", sendOrder);
});
</script>
</body>
</html>
